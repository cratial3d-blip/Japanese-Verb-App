# DATA_SPEC.md
## Language Data Specification — Japanese Verb Conjugation SRS App

This document defines the **source-of-truth data formats** for the language-learning content (verbs, conjugation templates, exceptions, and UI labels).

**Goal:** Keep language data accurate, reviewable, and independent from application code. The app must **only** use data from the `/data` folder and must not invent language content.

---

## 0) Core Rules

1. **Grading is hiragana-only.**  
   - User answers are normalized and compared against expected answers in **hiragana**.
   - Kanji is **display-only**. The SRS engine must never depend on kanji for correctness.

2. **Data is versioned and immutable once shipped.**  
   - Files use a `v#` naming convention (e.g., `verbs.v1.jsonl`).
   - Once a version is used in a release, do not edit it; create a new version (`v2`) and provide migration rules if needed.

3. **No hidden knowledge in code.**  
   - Verb lists, meanings, classifications, and exceptions must come from `/data`.
   - Code may implement rules (e.g., conjugation algorithms) but must not silently patch language data.

4. **Accuracy-first workflow.**  
   - During curation, some fields may be marked `unknown`.
   - Before release, validation must confirm that all required fields are complete and that no `unknown` remains for shipping-critical fields.

---

## 1) File Overview

### 1.1 Verbs
- **Path:** `/data/verbs/verbs.v1.jsonl` (legacy)
- **Path:** `/data/verbs/verbs.v2.jsonl` (current)
- **Format:** JSONL (one JSON object per line)
- **Why JSONL:** clean diffs, easy incremental edits, safe appends.

### 1.2 Conjugation Templates
- **Path:** `/data/conjugations/conjugation_templates.v1.json` (legacy)
- **Path:** `/data/conjugations/conjugation_templates.v2.json` (current)
- **Format:** JSON array (small, stable list)

### 1.3 Exceptions
- **Path:** `/data/exceptions/verb_exceptions.v1.json`
- **Format:** JSON object (small, auditable)

### 1.4 UI Labels / Text
- **Path:** `/data/ui_text/labels.v1.json`
  - **Format:** JSON object (key-value strings)
- **Path:** `/data/ui_text/example_sentences.v3.json` (current)
  - **Format:** JSON object (template -> example sentence patterns)

---

## 2) Verbs Dataset Spec (`verbs.v2.jsonl`)

Each line is a single verb record.

### 2.1 Required Fields
- `id` (string)  
  Stable unique identifier. **Never change after shipping.**
- `kana` (string)  
  Dictionary form in **hiragana** (e.g., `いく`, `たべる`).
- `gloss_en` (string[])  
  One or more short English meanings (e.g., `["to go"]`, `["to exist (animate)","to be (people/animals)"]`).

### 2.2 Strongly Recommended Fields
- `kanji` (string | null)  
  Dictionary form in kanji/kana mix for display (e.g., `行く`). May be `null` if not applicable.
- `level` (string)  
  Initial allowed values: `N5`, `N4`, `N5_N4_POOL`. (We may later add `N3`, etc.)
- `verb_class` (string)  
  Allowed values: `godan`, `ichidan`, `irregular`, `unknown`  
  - `unknown` is allowed **only during curation**. Before shipping, all must be resolved.

### 2.3 Optional Fields
- `disambiguation` (string | null)  
  Use when multiple verbs share the same `kana` (e.g., `いる` “exist (animate)” vs `いる` “need”).  
  Examples: `"exist (animate)"`, `"need/require"`.
- `notes` (string | null)  
  Short internal notes (e.g., “often written in kana”, “two common kanji spellings”).

### 2.4 Data Rules
- **`kana` must be hiragana-only.**  
  No romaji, no spaces. (Katakana-only verbs are not expected in this scope.)
- **`gloss_en` meanings must be short and non-sentence.**  
  Prefer `"to run"` not `"to run fast in a race"`.
- **Duplicates of `kana` are allowed** only if:
  - `id` is different, and
  - `disambiguation` clearly distinguishes them.
- **v1:** Do not store conjugations per-verb in the dataset. Conjugations are generated by rules and verified by tests.
- **v2 extension:** `new_conjugations` is allowed for templates that are data-driven (not rule-generated yet).
  - `new_conjugations` is a map of `template_id -> expected_hiragana`.

### 2.5 ID Convention (Recommended)
Pick a stable format that remains unique even when kana duplicates exist.

Recommended pattern:
- `"{kana}_{sense}_{nn}"` where:
  - `kana` is hiragana
  - `sense` is a short ASCII tag (`meet`, `fit`, `exist_animate`, `need`, etc.)
  - `nn` is a two-digit sequence if needed

Examples:
- `いく_go_01`
- `いる_exist_animate_01`
- `いる_need_01`
- `あう_meet_01`
- `あう_fit_01`

### 2.6 Verb Record Example (Structure Only)
```json
{"id":"いく_go_01","kana":"いく","kanji":"行く","gloss_en":["to go"],"level":"N5","verb_class":"godan","disambiguation":null,"notes":null}
```

### 2.7 v2 Optional Field: `new_conjugations`
```json
"new_conjugations": {
  "plain_tai": "????????????",
  "plain_te_mo_ii": "??????????????????"
}
```


---

## 3) Conjugation Templates Spec (`conjugation_templates.v2.json`)

Templates define which conjugation prompts exist in the app. They do **not** store answers.

### 3.1 Required Fields
- `id` (string)  
  Stable identifier used by the app (e.g., `plain_past`, `polite_negative`).
- `label` (string)  
  Human-readable label (e.g., `"Plain past"`).
- `politeness` (string)  
  Allowed: `plain`, `polite`
- `category` (string)  
  Allowed: `dictionary`, `negative`, `past`, `past_negative`, `te_form`
- `active` (boolean)  
  Allows enabling/disabling templates without deleting them.

### 3.2 Template Rules
- Template IDs must be stable across versions.
- Templates must be compatible with hiragana-only grading.
- Templates should remain minimal for MVP (N5 scope first).

---

## 4) Exceptions Spec (`verb_exceptions.v1.json`)

Exceptions are a **small explicit list** that overrides general rules.

### 4.1 Required Keys
- `irregular_verbs` (string[])  
  Must include: `する`, `くる`, and any other declared irregulars.
- `special_cases` (object)  
  A keyed map for rule overrides (e.g., `いく` te/past behavior).

### 4.2 Recommended Keys
- `godan_ru_exceptions` (string[])  
  Verbs ending in `る` that are **godan**, not ichidan (e.g., `はいる`, `かえる`).
- `ambiguous_kana` (object)  
  Map `kana -> [verb_id, ...]` for cases like `いる`.

### 4.3 Exception Rules
- Exceptions must be minimal and auditable.
- If an exception is needed, prefer putting it here rather than “hardcoding” it in logic.

---

## 5) UI Labels Spec (`labels.v1.json`)

Key-value text used by the UI (and potentially localization later).

### 5.1 Rules
- Keys are stable (snake_case), e.g.:
  - `app_title`
  - `start_reviews`
  - `hint_used`
- Values are English strings for now.
- No business logic depends on labels.

---

## 6) Validation Requirements

A validation script (`/scripts/validate_data.*`) must enforce:
- JSON schema validation for each dataset file
- For verbs JSONL:
  - unique `id`
  - `kana` contains only hiragana
  - required fields present
- No `unknown` `verb_class` when running “release validation” mode
- Conjugation template IDs are unique and match allowed enums

---

## 7) “No Guessing” Rule for Codex / Builders

When building application logic:
- The app must **only** display and schedule content present in `/data`.
- If a verb is missing `verb_class` or an exception is unclear, code must **fail loudly** (validation error) rather than guessing.

---

End of spec.
